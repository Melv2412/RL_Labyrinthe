<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reinforcement Learning Debugger</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>
<body>
    <div class="game-container">
        <div class="maze-section">
            <div class="maze-grid" style="grid-template-columns: repeat({{ maze.0|length }}, 1fr);">
                {% for row in maze %}
                    {% for cell in row %}
                        {% with row_idx=forloop.parentloop.counter0 col_idx=forloop.counter0 %}
                            {% with key=row_idx|stringformat:"d"|add:","|add:col_idx|stringformat:"d" %}
                                <div class="cell 
                                    {% if cell == '#' %}wall
                                    {% elif cell == 'S' %}start{% if key in path_str %} path{% endif %}
                                    {% elif cell == 'G' %}goal{% if key in path_str %} path{% endif %}
                                    {% elif cell == 'T' %}treasure
                                    {% elif cell == 'P' %}portal
                                    {% elif cell == 'X' %}trap
                                    {% elif key in path_str %}path
                                    {% else %}empty
                                    {% endif %}">
                                    {% if cell == 'S' %}S
                                    {% elif cell == 'G' %}G
                                    {% elif cell == 'T' %}ðŸ’°
                                    {% elif cell == 'P' %}ðŸŒ€
                                    {% elif cell == 'X' %}âš 
                                    {% elif cell == '#' %}
                                    {% elif key in path_str %}â€¢
                                    {% endif %}
                                </div>
                            {% endwith %}
                        {% endwith %}
                    {% endfor %}
                {% endfor %}
            </div>
        </div>

        <div class="debugger-section">
            <h1>Reinforcement Learning Debugger</h1>
            
            <div class="stats">
                <div class="stat-line">
                    <span class="stat-label">Current Episode:</span>
                    <span class="stat-value">1000</span>
                </div>
                <div class="stat-line">
                    <span class="stat-label">Epsilon:</span>
                    <span class="stat-value">0.10</span>
                </div>
                <div class="stat-line">
                    <span class="stat-label">Epsilon (Exploration Rate):</span>
                    <span class="stat-value">0.10</span>
                </div>
                <div class="stat-line">
                    <span class="stat-label">Alpha (Learning Rate):</span>
                    <span class="stat-value">0.10</span>
                </div>
                <div class="stat-line">
                    <span class="stat-label">Gamma (Discount Factor):</span>
                    <span class="stat-value">0.90</span>
                </div>
            </div>

            <div class="heatmap-container">
                <div class="heatmap-title">Q-Table Heatmap</div>
                <div class="heatmap-grid" style="grid-template-columns: repeat({{ maze.0|length }}, 1fr);">
                    {% for row in maze %}
                        {% for cell in row %}
                            {% with row_idx=forloop.parentloop.counter0 col_idx=forloop.counter0 %}
                                {% with key=row_idx|stringformat:"d"|add:","|add:col_idx|stringformat:"d" %}
                                    <div class="heatmap-cell" 
                                         style="background-color: 
                                         {% if cell == '#' %}#000000
                                         {% elif cell == 'S' %}#22c55e
                                         {% elif cell == 'G' %}#3b82f6
                                         {% elif key in path_str %}#fbbf24
                                         {% else %}#1e293b
                                         {% endif %};">
                                    </div>
                                {% endwith %}
                            {% endwith %}
                        {% endfor %}
                    {% endfor %}
                </div>
            </div>

            <div class="log-container">
                <div class="log-line">Training completed</div>
                <div class="log-line">Path found: {{ path_str|length }} steps</div>
                <div class="log-line">Optimal policy extracted</div>
                <div class="log-line">Agent reached goal successfully</div>
            </div>

            <div class="controls">
                <button class="btn" onclick="window.location.reload();">Retrain</button>
                <button class="btn" onclick="window.location.href='{% url 'home' %}';">Menu</button>
            </div>
        </div>
    </div>
</body>
</html>